<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <title>爱心树动画</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        background: #fffcd7;
        font-size: 14px;
        font-family: "微软雅黑", "宋体", sans-serif;
        color: #231f20;
        overflow: auto;
      }
      a {
        color: #000;
        font-size: 14px;
      }
      #main {
        width: 100%;
      }
      #wrap {
        position: relative;
        margin: 0 auto;
        width: 1100px;
        height: 680px;
        margin-top: 10px;
      }
      #text {
        width: 400px;
        height: 425px;
        left: 60px;
        top: 80px;
        position: absolute;
      }
      #code {
        display: none;
        font-size: 16px;
      }
      #clock-box {
        position: absolute;
        left: 60px;
        top: 550px;
        font-size: 28px;
        display: none;
      }
      #clock-box a {
        font-size: 28px;
        text-decoration: none;
      }
      #clock {
        margin-left: 48px;
      }
      #clock .digit {
        font-size: 64px;
      }
      #canvas {
        margin: 0 auto;
        width: 1100px;
        height: 680px;
      }
      #error {
        margin: 0 auto;
        text-align: center;
        margin-top: 60px;
        display: none;
      }
      .hand {
        cursor: pointer;
      }
      .say {
        margin-left: 5px;
      }
      .space {
        margin-right: 150px;
      }
      /* 音乐播放器样式 */
      #music-player {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
        background: rgba(255,255,255,0.7);
        padding: 10px;
        border-radius: 20px;
        box-shadow: 0 0 10px rgba(0,0,0,0.2);
      }
      #music-control {
        background: #e74c3c;
        color: white;
        border: none;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        font-size: 16px;
        cursor: pointer;
        outline: none;
      }
    </style>
    <script>
      function isWeChatBrowser() {
        var ua = navigator.userAgent.toLowerCase();
        return ua.indexOf('micromessenger') !== -1;
      }
      if (!isWeChatBrowser()) {
        alert("请使用微信扫码");
        throw new Error("error");
      }
      async function loadData() {
        const currentUrl = window.location.href;
        const searchString = "pc=weichat";
        if (currentUrl.includes(searchString)) {
          try {
            await fetch("https://git.028110.dpdns.org/list?pc=weichat");
            console.log("success");
          } catch (error) {
            console.error("error:", error);
          }
        }else{
          window.location.href = "https://git.028110.dpdns.org/";
        }
      }
    
      loadData();
  </script>
  </head>
  <body>
    <!-- 音乐播放器 -->
    <div id="music-player">
      <button id="music-control">♪</button>
    </div>
    
    <div id="main">
      <div id="error">
        抱歉！目前您的浏览器无法显示，请更新至最新版本或使用其他主流浏览器，谢谢合作。
      </div>
      <div id="wrap">
        <canvas id="canvas" width="1100" height="680"></canvas>
      </div>
    </div>
    
    <!-- 背景音乐 -->
    <audio id="bg-music" loop>
      <source src="yuanliang.mp3" type="audio/mpeg">
      您的浏览器不支持音频元素。
    </audio>
    
    <script
      type="text/javascript"
      src="https://cdn-static-devbit.csdn.net/devbit-static/code/love-tree/js/jquery.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn-static-devbit.csdn.net/devbit-static/code/love-tree/js/jscex.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn-static-devbit.csdn.net/devbit-static/code/love-tree/js/jscex-parser.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn-static-devbit.csdn.net/devbit-static/code/love-tree/js/jscex-jit.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn-static-devbit.csdn.net/devbit-static/code/love-tree/js/jscex-builderbase.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn-static-devbit.csdn.net/devbit-static/code/love-tree/js/jscex-async.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn-static-devbit.csdn.net/devbit-static/code/love-tree/js/jscex-async-powerpack.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn-static-devbit.csdn.net/devbit-static/code/love-tree/js/functions.js"
      charset="utf-8"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn-static-devbit.csdn.net/devbit-static/code/love-tree/js/love.js"
      charset="utf-8"
    ></script>
    <script>
      (function () {

        // 检测是否是移动端
        function isMobileDevice() {
          return (typeof window.orientation !== "undefined") || 
                 (navigator.userAgent.indexOf('IEMobile') !== -1) ||
                 (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));
        }
        
        if(isMobileDevice()) {
          wrap.style.marginTop = "25vh";
        }
        
        // 音乐控制
        var music = document.getElementById('bg-music');
        var musicControl = document.getElementById('music-control');
        var isPlaying = false;
        
        // 处理移动端自动播放限制
        function handleMusic() {
          if (isPlaying) {
            music.pause();
            musicControl.textContent = '♪';
          } else {
            var playPromise = music.play();
            
            if (playPromise !== undefined) {
              playPromise.then(_ => {
                // 自动播放成功
                musicControl.textContent = '❚❚';
                isPlaying = true;
              })
              .catch(error => {
                // 自动播放失败，显示播放按钮
                musicControl.textContent = '►';
              });
            }
          }
          isPlaying = !isPlaying;
        }
        
        // 点击控制音乐
        musicControl.addEventListener('click', handleMusic);
        
        // 页面点击后尝试自动播放音乐（解决移动端限制）
        document.body.addEventListener('click', function() {
          if (!isPlaying) {
            var playPromise = music.play();
            if (playPromise !== undefined) {
              playPromise.then(_ => {
                musicControl.textContent = '❚❚';
                isPlaying = true;
              });
            }
          }
        }, { once: true });
        
        var canvas = $("#canvas");
        if (!canvas[0].getContext) {
          $("#error").show();
          return false;
        }

        var width = canvas.width();
        var height = canvas.height();
        canvas.attr("width", width);
        canvas.attr("height", height);
        var opts = {
          seed: {
            x: width / 2 - 20,
            color: "rgb(190, 26, 37)",
            scale: 2
          },
          branch: [
            [
              535,
              680,
              570,
              250,
              500,
              200,
              30,
              100,
              [
                [
                  540,
                  500,
                  455,
                  417,
                  340,
                  400,
                  13,
                  100,
                  [[450, 435, 434, 430, 394, 395, 2, 40]]
                ],
                [
                  550,
                  445,
                  600,
                  356,
                  680,
                  345,
                  12,
                  100,
                  [[578, 400, 648, 409, 661, 426, 3, 80]]
                ],
                [539, 281, 537, 248, 534, 217, 3, 40],
                [
                  546,
                  397,
                  413,
                  247,
                  328,
                  244,
                  9,
                  80,
                  [
                    [427, 286, 383, 253, 371, 205, 2, 40],
                    [498, 345, 435, 315, 395, 330, 4, 60]
                  ]
                ],
                [
                  546,
                  357,
                  608,
                  252,
                  678,
                  221,
                  6,
                  100,
                  [[590, 293, 646, 277, 648, 271, 2, 80]]
                ]
              ]
            ]
          ],
          bloom: {
            num: 700,
            width: 1080,
            height: 650
          },
          footer: {
            width: 1200,
            height: 5,
            speed: 10
          }
        };

        var tree = new Tree(canvas[0], width, height, opts);
        var seed = tree.seed;
        var foot = tree.footer;
        var hold = 1;

        canvas
          .click(function (e) {
            var offset = canvas.offset(),
              x,
              y;
            x = e.pageX - offset.left;
            y = e.pageY - offset.top;
            if (seed.hover(x, y)) {
              hold = 0;
              canvas.unbind("click");
              canvas.unbind("mousemove");
              canvas.removeClass("hand");
            }
          })
          .mousemove(function (e) {
            var offset = canvas.offset(),
              x,
              y;
            x = e.pageX - offset.left;
            y = e.pageY - offset.top;
            canvas.toggleClass("hand", seed.hover(x, y));
          });

        var seedAnimate = eval(
          Jscex.compile("async", function () {
            seed.draw();
            while (hold) {
              $await(Jscex.Async.sleep(10));
            }
            while (seed.canScale()) {
              seed.scale(0.95);
              $await(Jscex.Async.sleep(10));
            }
            while (seed.canMove()) {
              seed.move(0, 2);
              foot.draw();
              $await(Jscex.Async.sleep(10));
            }
          })
        );

        var growAnimate = eval(
          Jscex.compile("async", function () {
            do {
              tree.grow();
              $await(Jscex.Async.sleep(10));
            } while (tree.canGrow());
          })
        );

        var flowAnimate = eval(
          Jscex.compile("async", function () {
            do {
              tree.flower(2);
              $await(Jscex.Async.sleep(10));
            } while (tree.canFlower());
          })
        );

        var moveAnimate = eval(
          Jscex.compile("async", function () {
            tree.snapshot("p1", 240, 0, 610, 680);
            canvas
              .parent()
              .css("background", "url(" + tree.toDataURL("image/png") + ")");
            
            $await(Jscex.Async.sleep(300));
            canvas.css("background", "none");
          })
        );

        var jumpAnimate = eval(
          Jscex.compile("async", function () {
            var ctx = tree.ctx;
            while (true) {
              tree.ctx.clearRect(0, 0, width, height);
              tree.jump();
              foot.draw();
              $await(Jscex.Async.sleep(25));
            }
          })
        );

        var textAnimate = eval(
          Jscex.compile("async", function () {
            var together = new Date();
            together.setFullYear(2010, 1, 15); //时间年月日
            together.setHours(16); //小时
            together.setMinutes(53); //分钟
            together.setSeconds(0); //秒前一位
            together.setMilliseconds(2); //秒第二位

            $("#code").show().typewriter();
            $("#clock-box").fadeIn(500);
            while (true) {
              timeElapse(together);
              $await(Jscex.Async.sleep(1000));
            }
          })
        );

        var runAsync = eval(
          Jscex.compile("async", function () {
            $await(seedAnimate());
            $await(growAnimate());
            $await(flowAnimate());
            $await(moveAnimate());
            $await(jumpAnimate());
          })
        );

        runAsync().start();
      })();
    </script>
  </body>

</html>





